\newcommand{\deltaMcu}{\Delta t_{\mu C}}
\newcommand{\deltaRtc}{\Delta t_{RTC}}
\newcommand{\wMcu}{w_{\mu C}}
\newcommand{\wRtc}{w_{RTC}}
\newcommand{\correctionValue}{\Delta t}

\subsection{SetTimeCorrectionConfig}
\texttt{SetTimeCorrectionConfig} Configures time correction mechanism.

\subsubsection{Success response}
Success response frame is of type \texttt{TimeCorrectionSuccessFrame} and contains no additional payload.

\subsubsection{Error response}
Error frame is of type \texttt{TimeCorrectionErrorFrame} and contains error code:

\begin{tabular}{r | l}
    Error code & Value \\
    \hline
    -1 & Cannot set time correction configuration with both weights equal to 0 \\
    -2 & Error when setting the persistent state value for time configuration \\
    
\end{tabular}

\subsubsection{Definition}
\ctor{SetTimeCorrectionConfig}

Arguments: 

\begin{tabular}{r | l | l}
    Argument                    & Description               & Size [bits] \\
    \hline
    \texttt{correlation\_id}    & Correlation id            & 8 \\
    \texttt{missionTimeWeight}  & Value for \hyperref[sec:time-wMcu]{$\wMcu$} & 16 LE \\
    \texttt{externalTimeWeight} & Value for \hyperref[sec:time-wRtc]{$\wRtc$} & 16 LE \\

\end{tabular}

Notice:
\begin{itemize}
    \item Setting \texttt{externalTimeWeight} to 0 means disabling external RTC's influence on mission time. Mission time will be measured by internal MCU clock alone.
    \item Setting \texttt{missionTimeWeight} to 0 means disabling internal MCU clock's influence on mission time. Mission time will still be measured by internal MCU clock (ticks), but each time the correction procedure is run, the time will be reset to value indicated by external RTC.
    \item Both \texttt{missionTimeWeight} and \texttt{externalTimeWeight} cannot be 0.
\end{itemize}

\subsection{Time Correction procedure}

The final time correction is calculated using weighted sum from two deltas (based on measuring time from two sources):

$\correctionValue = \frac{\wMcu \deltaMcu + \wRtc \deltaRtc}{\wMcu + \wRtc}$

where:

\begin{tabular}{r | l}
    Symbol & Meaning \\
    \hline
    $\deltaMcu$ & time change according to microcontroller clock \\ 
    $\deltaRtc$ & time change according to external real time clock \\
    \label{sec:time-wMcu} $\wMcu$ & weight for $\deltaMcu$ \\
    \label{sec:time-wRtc} $\wRtc$ & weight for $\deltaRtc$ \\
\end{tabular}

The maximum allowed value for $\correctionValue$ is 2 hours. If the $\correctionValue > 2 hours$ then the correction is abandoned and current time is assumed to be time indicated by microcontroller clock.


\subsubsection{Example usage}
Perform power cycle, correlation ID = 11
\binaryForm{SetTimeCorrectionConfig(11, 8, 8)}

